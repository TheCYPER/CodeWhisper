import requests


def get_ai_feedback(code):
    host = "192.168.110.65"
    port = "11434"
    url = f"http://{host}:{port}/api/chat"

    # æ„é€ å¯¹è¯å†å²ï¼ˆæ”¯æŒå¤šè½®ä¸Šä¸‹æ–‡ï¼‰
    messages = [
        {
            "role": "system",
            "content": "ä½ æ˜¯ä¸€ä¸ªç¼–ç¨‹æ•™å­¦åŠ©æ‰‹ï¼Œéœ€è¦ç”¨æ¯”å–»å’Œåˆ†æ­¥éª¤çš„æ–¹å¼å¸®åŠ©æ–°æ‰‹ç†è§£ä»£ç "
        },
        {
            "role": "user",
            "content": f"è¯·åˆ†æä»¥ä¸‹ä»£ç ï¼š\n{code}\nè¦æ±‚ï¼š1.æŒ‡å‡ºé”™è¯¯ 2.ç»™å‡ºä¼˜åŒ–å»ºè®® 3.ç”¨æ¯”å–»è§£é‡Šå…³é”®æ¦‚å¿µ"
        }
    ]

    data = {
        "model": "deepseek-r1:14b",  # ç¡®ä¿ä¸ollama listä¸­çš„æ¨¡å‹åç§°ä¸€è‡´
        "options": {
            "temperature": 0.3  # æ•™å­¦åœºæ™¯å»ºè®®0.3-0.7å¹³è¡¡ç¨³å®šæ€§ä¸åˆ›é€ æ€§
        },
        "stream": False,
        "messages": messages
    }

    try:
        response = requests.post(url, json=data, timeout=60)
        if response.status_code == 200:
            return response.json()['message']['content']  # æ³¨æ„å­—æ®µå˜åŒ–ï¼
        else:
            return f"AIæœåŠ¡é”™è¯¯: {response.text}"
    except Exception as e:
        return f"è¿æ¥å¤±è´¥: {str(e)}"

'''
# åœ¨get_ai_feedbackå‡½æ•°ä¸­å¢åŠ æ•™å­¦é€»è¾‘
prompt = f"""
æ ¹æ®ç”¨æˆ·ä»£ç çš„æ•™å­¦çº§åˆ«ï¼ˆæ–°æ‰‹/ä¸­çº§ï¼‰ï¼Œç”¨{level}å¯¹åº”çš„æ–¹å¼è§£é‡Šï¼š
1. [é”™è¯¯æ£€æµ‹] å¦‚æœä»£ç å­˜åœ¨è¯­æ³•é”™è¯¯ï¼ŒæŒ‡å‡ºå…·ä½“è¡Œå·
2. [çŸ¥è¯†å¡ç‰‡] ç”¨'æ¯”å–»ï¼š'å¼€å¤´è¯´æ˜æ ¸å¿ƒæ¦‚å¿µï¼ˆå¦‚å˜é‡æ¯”å–»ä¸ºå‚¨ç‰©æŸœï¼‰
3. [æŒ‘æˆ˜ä»»åŠ¡] ç”Ÿæˆä¸€ä¸ªä¸å½“å‰ä»£ç ç›¸å…³çš„å°ç»ƒä¹ ï¼ˆå¦‚'å°è¯•å°†forå¾ªç¯æ”¹ä¸ºwhileå¾ªç¯'ï¼‰
"""
'''
'''
# åœ¨HTMLä¸­æ·»åŠ æˆå°±ç³»ç»Ÿï¼ˆçº¯å‰ç«¯å®ç°ï¼‰
<div id="achievements">
    <h4>å·²è§£é”æˆå°±ï¼š</h4>
    <p>âœ… å®Œæˆç¬¬ä¸€ä¸ªç¨‹åº</p>
    <p>ğŸ•¹ï¸ ä¿®å¤3ä¸ªé”™è¯¯ï¼ˆ2/3ï¼‰</p>
</div>
'''
